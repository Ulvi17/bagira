<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bagira AI - Интеллектуальный ассистент для юридических фирм</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #7A3FFD;
      --primary-darker: #6028d1;
      --secondary-color: #22A39F;
      --text-color-dark: #2c3e50;
      --text-color-light: #5a6a7a;
      --bg-light: #f8f9fa;
      --bg-white: #ffffff;
      --border-color: #e0e0e0;
      --success-color: #28a745;
      --error-color: #dc3545;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      margin: 0;
      background-color: var(--bg-light);
      color: var(--text-color-dark);
      line-height: 1.6;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .container {
      width: 90%;
      max-width: 1024px;
      margin: 0 auto;
      padding: 0 15px;
    }
    .btn {
      display: inline-block;
      padding: 12px 24px;
      font-weight: 600;
      font-size: 1rem;
      text-decoration: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s ease-in-out, transform 0.1s ease, box-shadow 0.2s ease;
      text-align: center;
      border: none;
    }
    .btn-primary {
      background-color: var(--primary-color);
      color: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .btn-primary:hover {
      background-color: var(--primary-darker);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    header.page-header {
      background-color: var(--bg-white);
      padding: 20px 0;
      border-bottom: 1px solid var(--border-color);
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 999;
    }
    header.page-header .logo-container {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 5px;
    }
    header.page-header .logo-icon {
        font-size: 2.5rem;
        color: var(--primary-color);
        margin-right: 10px;
        line-height: 1;
    }
    header.page-header h1.site-title {
      color: var(--text-color-dark);
      font-size: 2.2rem;
      margin: 0;
      font-weight: 700;
    }
    header.page-header .tagline {
      color: var(--text-color-light);
      font-size: 1rem;
      font-weight: 400;
      margin: 0;
    }

    .hero-section {
        background-color: var(--bg-white);
        color: var(--text-color-dark);
        padding: 70px 0 60px 0;
        text-align: center;
    }
    .hero-section .container {
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .hero-section .main-page-heading {
        font-size: 2.8rem;
        font-weight: 800;
        margin-bottom: 20px;
        line-height: 1.2;
        max-width: 800px;
    }
    .hero-section .hero-subheading {
        font-size: 1.25rem;
        color: var(--text-color-light);
        margin-bottom: 30px;
        max-width: 700px;
    }

    main {
        flex: 1;
    }

    .features-section, .pilot-section, .cta-vapi-section {
        padding: 60px 0;
        text-align: center;
    }
    .features-section { background-color: var(--bg-light); }
    .pilot-section { background-color: var(--bg-white); }
    .cta-vapi-section {
      background: linear-gradient(45deg, var(--primary-color), var(--primary-darker));
      color: white;
      padding: 80px 0;
    }
    .cta-vapi-section h3 { font-size: 2rem; margin-bottom: 10px; }
    .cta-vapi-section p { font-size: 1.1rem; max-width: 600px; margin: auto; opacity: 0.9;}

    .section-heading {
        font-size: 2.2rem;
        font-weight: 700;
        margin-bottom: 40px;
    }

    .features-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 30px;
        text-align: left;
    }
    .feature-card {
        background: var(--bg-white);
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        border: 1px solid var(--border-color);
    }
    .feature-card .feature-icon {
        font-size: 2.5rem;
        color: var(--primary-color);
        margin-bottom: 15px;
    }
    .feature-card h3 {
        font-size: 1.4rem;
        margin-bottom: 10px;
    }
    .feature-card p {
        color: var(--text-color-light);
        font-size: 1rem;
    }

    .pilot-section p {
        font-size: 1.1rem;
        max-width: 700px;
        margin: 0 auto 30px auto;
        color: var(--text-color-light);
    }

    footer.page-footer {
      background-color: var(--text-color-dark);
      color: var(--bg-light);
      text-align: center;
      padding: 30px 0;
      margin-top: auto;
    }

    /* Modal Styles */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0; top: 0;
        width: 100%; height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.5);
        align-items: center;
        justify-content: center;
    }
    .modal-content {
        background-color: #fff;
        margin: auto;
        padding: 30px;
        border: 1px solid #888;
        width: 90%;
        max-width: 500px;
        border-radius: 8px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        position: relative;
    }
    .close-button {
        color: #aaa;
        position: absolute;
        top: 10px;
        right: 20px;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }
    .close-button:hover, .close-button:focus {
        color: #000;
    }
    .modal-content h2 {
        margin-top: 0;
        font-size: 1.8rem;
    }
    .modal-content form label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
    }
    .modal-content form input {
        width: 100%;
        padding: 12px;
        margin-bottom: 20px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        box-sizing: border-box;
    }
    .modal-content form button {
        width: 100%;
    }
    .modal-message {
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
        display: none;
        text-align: center;
    }
    .modal-message.success {
        background-color: #e8f5e9;
        color: var(--success-color);
        border: 1px solid var(--success-color);
    }
    .modal-message.error {
        background-color: #ffebee;
        color: var(--error-color);
        border: 1px solid var(--error-color);
    }
    
    /* NEW: Styles for the custom Vapi floating button */
    .vapi-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      background-color: var(--primary-color);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      transition: all 0.3s ease;
      z-index: 9999;
    }
    .vapi-button:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    }
    .vapi-button .vapi-icon {
      color: white;
      font-size: 24px;
      transition: opacity 0.2s ease;
    }
    .vapi-button.active {
      background-color: var(--error-color);
    }
    .vapi-button .vapi-icon.stop {
        display: none;
    }
     .vapi-button .vapi-icon.mic {
        display: block;
    }
    .vapi-button.active .vapi-icon.mic {
        display: none;
    }
    .vapi-button.active .vapi-icon.stop {
        display: block;
    }

    @media (max-width: 992px) {
        .hero-section .main-page-heading { font-size: 2.4rem; }
        .hero-section .hero-subheading { font-size: 1.1rem; }
        header.page-header .logo-icon { font-size: 2rem; }
        header.page-header h1.site-title { font-size: 1.8rem; }
    }
    @media (max-width: 768px) {
        .hero-section .main-page-heading { font-size: 2rem; }
        .hero-section .hero-subheading { font-size: 1rem; }
    }
  </style>
</head>
<body>
  <header class="page-header">
    <div class="container">
      <div class="logo-container">
        <i class="fas fa-paw logo-icon"></i>
        <h1 class="site-title">Bagira AI</h1>
      </div>
      <p class="tagline">Интеллектуальный ассистент для юридических фирм</p>
    </div>
  </header>

  <main>
    <section class="hero-section">
      <div class="container">
        <h2 class="main-page-heading">Освободите до 80% времени ваших юристов от рутинных задач</h2>
        <p class="hero-subheading">
          Bagira AI берет на себя первичную консультацию, квалификацию лидов и запись на прием, позволяя вашим специалистам сфокусироваться на клиентах.
        </p>
        <a href="#pilot-section" class="btn btn-primary">Узнать больше</a>
      </div>
    </section>

    <section class="features-section">
      <div class="container">
        <h2 class="section-heading">Как Bagira AI помогает вашему бизнесу</h2>
        <div class="features-grid">
          <div class="feature-card">
            <div class="feature-icon"><i class="fas fa-headset"></i></div>
            <h3>Автоматизация первого контакта</h3>
            <p>Bagira AI круглосуточно отвечает на звонки и сообщения, проводит первичную консультацию по вашему скрипту и собирает контактные данные.</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon"><i class="fas fa-user-check"></i></div>
            <h3>Квалификация лидов</h3>
            <p>Наш ассистент задает правильные вопросы, чтобы определить перспективность клиента и передать вашим юристам только целевые заявки.</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon"><i class="fas fa-calendar-alt"></i></div>
            <h3>Интеграция с календарем</h3>
            <p>Bagira AI автоматически проверяет свободные слоты и записывает клиентов на консультацию прямо в ваш рабочий календарь.</p>
          </div>
        </div>
      </div>
    </section>

    <section id="pilot-section" class="pilot-section">
        <div class="container">
            <h2 class="section-heading">Запустите пилотный проект бесплатно</h2>
            <p>
                Мы предлагаем вам бесплатно настроить и запустить Bagira AI для вашей компании. Оцените, как искусственный интеллект может трансформировать вашу работу с клиентами, увеличить конверсию и снизить нагрузку на персонал.
            </p>
            <button id="joinPilotBtnHero" class="btn btn-primary">Присоединиться к пилоту</button>
        </div>
    </section>

    <section class="cta-vapi-section">
      <div class="container">
        <h3>Попробуйте Bagira AI в действии</h3>
        <p>
          Узнайте, как Bagira AI взаимодействует с потенциальными клиентами. Нажмите на иконку микрофона и запишитесь на консультацию.
        </p>
      </div>
    </section>
  </main>

  <footer class="page-footer">
    <div class="container">
      &copy; <span id="currentYear"></span> Bagira AI. Все права защищены.
    </div>
  </footer>

  <!-- Pilot Program Modal -->
  <div id="pilotFormModal" class="modal">
    <div class="modal-content">
        <span id="closePilotModal" class="close-button">&times;</span>
        <h2>Заявка на участие в пилотном проекте</h2>
        <form id="pilotProgramForm">
            <label for="pilotName">Ваше имя:</label>
            <input type="text" id="pilotName" required>
            <label for="pilotCompanyName">Название компании:</label>
            <input type="text" id="pilotCompanyName" required>
            <label for="pilotWebsite">Сайт компании:</label>
            <input type="text" id="pilotWebsite" required>
            <button type="submit" id="submitPilotForm" class="btn btn-primary">Отправить заявку</button>
        </form>
        <div id="pilotFormMessage" class="modal-message"></div>
    </div>
  </div>

  <!-- Bagira Client Form Modal -->
  <div id="bagiraFormModal" class="modal">
    <div class="modal-content">
        <span id="closeBagiraModal" class="close-button">&times;</span>
        <h2 id="bagiraModalHeader">Подтверждение записи</h2>
        <form id="bagiraForm">
            <input type="hidden" id="clientSessionId" name="clientSessionId" value="">
            <label for="phoneInput">Номер телефона:</label>
            <input type="tel" id="phoneInput" required placeholder="+7 (XXX) XXX-XX-XX">
            <label for="emailInput">Email:</label>
            <input type="email" id="emailInput" required placeholder="example@email.com">
            <button type="submit" class="btn btn-primary">Отправить данные</button>
        </form>
        <div id="pilotFormMessage" class="modal-message"></div>
    </div>
  </div>

  <!-- NEW: Custom Vapi Button HTML -->
  <div id="vapi-button" class="vapi-button">
    <i class="fas fa-microphone vapi-icon mic"></i>
    <i class="fas fa-phone-slash vapi-icon stop"></i>
  </div>

  <!-- SCRIPT SECTION AT THE END OF BODY -->
  <script type="module">
    // Import the Vapi class directly from a reliable, modern ES Module CDN link
    import Vapi from 'https://esm.sh/@vapi-ai/web';

    // Set the current year in the footer
    document.getElementById('currentYear').textContent = new Date().getFullYear();

    // Generate a new, unique client session ID for every page load.
    const clientSessionId = crypto.randomUUID();
    console.log(`Generated new Client Session ID for this visit: ${clientSessionId}`);

    // Set the hidden input's value for form submission
    document.getElementById('clientSessionId').value = clientSessionId;

    const apiKey = "58f89212-0e94-4123-8f9e-3bc0dde56fe0";
    const vapiSquadId = "541e48cf-1f4a-423b-875f-889c6917a56d";
    
    // Initialize Vapi using the imported class
    const vapi = new Vapi(apiKey);
    let isCallActive = false;

    // --- Get references to all modals and form elements ---
    const pilotModal = document.getElementById("pilotFormModal");
    const joinPilotBtn = document.getElementById("joinPilotBtnHero");
    const closePilotModalBtn = document.getElementById("closePilotModal");
    const pilotProgramForm = document.getElementById("pilotProgramForm");
    const pilotFormMessage = document.getElementById("pilotFormMessage");
    const submitPilotFormBtn = document.getElementById("submitPilotForm");
    const bagiraModal = document.getElementById("bagiraFormModal");
    const bagiraClientForm = document.getElementById("bagiraForm");
    const closeBagiraModalBtn = document.getElementById("closeBagiraModal");
    const phoneClientInput = document.getElementById("phoneInput");
    const bagiraModalHeader = document.getElementById("bagiraModalHeader");
    const vapiButton = document.getElementById('vapi-button');

    // --- Modal Logic (unchanged) ---
    if (joinPilotBtn) {
      joinPilotBtn.addEventListener("click", () => {
        if (pilotModal) {
          pilotModal.style.display = "flex";
          if (pilotFormMessage) pilotFormMessage.style.display = "none";
          if (pilotProgramForm) pilotProgramForm.reset();
        }
      });
    }

    if (closePilotModalBtn) {
      closePilotModalBtn.addEventListener("click", () => {
        if (pilotModal) pilotModal.style.display = "none";
      });
    }
    
    if(closeBagiraModalBtn) {
      closeBagiraModalBtn.addEventListener("click", () => { bagiraModal.style.display = "none"; });
    }

    window.addEventListener("click", (event) => {
      if (event.target === pilotModal) {
        pilotModal.style.display = "none";
      }
      if (event.target === bagiraModal) {
        bagiraModal.style.display = "none";
      }
    });

    if (pilotProgramForm) {
      pilotProgramForm.addEventListener("submit", function (e) {
        e.preventDefault();
        if(pilotFormMessage) pilotFormMessage.style.display = "none";
        if(submitPilotFormBtn) {
            submitPilotFormBtn.disabled = true;
            submitPilotFormBtn.textContent = "Отправка...";
        }
        const formData = {
            name: document.getElementById("pilotName").value,
            companyName: document.getElementById("pilotCompanyName").value,
            website: document.getElementById("pilotWebsite").value
        };
        fetch("https://primary-production-3672.up.railway.app/webhook/vapi-pilotform", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(formData)
        })
        .then(response => {
            if (response.ok) {
                if(pilotFormMessage) {
                    pilotFormMessage.textContent = "Спасибо! Мы скоро с вами свяжемся.";
                    pilotFormMessage.className = "modal-message success";
                }
                pilotProgramForm.reset();
            } else {
                return response.json().catch(() => ({ 
                    message: response.statusText || "Неизвестная ошибка сервера"
                })).then(err => { throw err; });
            }
        })
        .catch(error => {
            console.error("Ошибка отправки пилотной формы:", error);
            let errorMessage = "Ошибка отправки. Пожалуйста, попробуйте еще раз.";
            if (error && error.message) { errorMessage = error.message; }
            else if (typeof error === 'string') { errorMessage = error; }
            if(pilotFormMessage) {
                pilotFormMessage.textContent = "Ошибка: " + errorMessage;
                pilotFormMessage.className = "modal-message error";
            }
        })
        .finally(() => {
            if(submitPilotFormBtn) {
                submitPilotFormBtn.disabled = false;
                submitPilotFormBtn.textContent = "Отправить заявку";
            }
            if(pilotFormMessage) pilotFormMessage.style.display = "block";
        });
      });
    }

    if(bagiraClientForm) {
      bagiraClientForm.addEventListener("submit", function(e) {
        e.preventDefault();
        const phone = phoneClientInput.value;
        const email = document.getElementById("emailInput").value;
        const submitButton = bagiraClientForm.querySelector('button[type="submit"]');
        const originalButtonText = "Отправить данные";
        submitButton.disabled = true;
        submitButton.textContent = "Отправка...";
        const payload = {
            phone: phone,
            email: email,
            clientSessionId: clientSessionId 
        };
        console.log("Sending form data to webhook:", payload);
        fetch("https://primary-production-3672.up.railway.app/webhook/bagira-submit", {
            method: "POST", 
            headers: { "Content-Type": "application/json" }, 
            body: JSON.stringify(payload)
        })
        .then(response => {
            if (response.ok) { alert("Спасибо! Мы скоро направим информацию по указанному номеру телефона или почте"); }
            else { alert("Ошибка отправки. ❌ Пожалуйста, попробуйте еще раз или свяжитесь с поддержкой."); }
            bagiraModal.style.display = "none";
            bagiraClientForm.reset(); 
        })
        .catch(error => {
            console.error("Ошибка отправки формы Bagira AI:", error);
            alert("Что-то пошло не так. ❌\n" + (error.message || error));
        })
        .finally(() => {
            submitButton.disabled = false;
            submitButton.textContent = originalButtonText;
        });
      });
    }

    // --- Vapi Specific Logic ---
    vapiButton.addEventListener('click', () => {
      if (isCallActive) {
        vapi.stop();
      } else {
        // FINAL CORRECTED VERSION based on official VAPI documentation.
        // The first argument is the assistant/squad ID.
        // The second is an overrides object.
        vapi.start(vapiSquadId, {
          variableValues: { clientSessionId: clientSessionId }
        });
      }
    });
    
    vapi.on('call-start', ({ call }) => {
      console.log(`VAPI call started. VAPI Call ID: ${call.id}, Our Client Session ID: ${clientSessionId}`);
      isCallActive = true;
      vapiButton.classList.add('active');
    });

    vapi.on('call-end', () => {
      console.log('Call has ended');
      isCallActive = false;
      vapiButton.classList.remove('active');
    });

    vapi.on('error', (e) => {
        console.error('Vapi Error:', e);
        isCallActive = false;
        vapiButton.classList.remove('active');
    });

    vapi.on("message", (message) => {
      if (message.type === "transcript" && message.role === "assistant" && message.transcriptType === "final" && message.transcript) {
        const assistantUtterance = message.transcript.toLowerCase().trim();
        console.log("Assistant's final message:", assistantUtterance);
        const coreTriggerPhrase = "please type your phone number below to confirm.";
        if (assistantUtterance.includes(coreTriggerPhrase)) {
          console.log("Trigger phrase detected! Opening modal.");
          if (bagiraModal.style.display !== "flex") {
            bagiraModal.style.display = "flex";
            phoneClientInput.focus();
            bagiraModalHeader.textContent = "Пожалуйста, введите ваш телефон и email для подтверждения записи.";
          }
        }
      }
    });
  </script>
</body>
</html>
